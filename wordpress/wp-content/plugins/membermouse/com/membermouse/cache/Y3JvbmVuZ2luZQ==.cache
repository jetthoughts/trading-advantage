/**
 *
 * MemberMouse(TM) (http://www.membermouse.com)
 * (c) MemberMouse, LLC. All rights reserved.
 */
class MM_CronEngine
{
	public static $MM_CRON_HOOK = "mm_cron_hook";
	public static $MM_CHECK_SCHEDULED_EVENT_QUEUE = "mm_check_scheduled_event_queue";
	
	public static function setup()
	{
		if(!wp_next_scheduled(self::$MM_CRON_HOOK))
		{
			wp_schedule_event(time(), 'daily', self::$MM_CRON_HOOK);
		}
		
		if(!wp_next_scheduled(self::$MM_CHECK_SCHEDULED_EVENT_QUEUE))
		{
			wp_schedule_event(time(), 'queue_check_interval', self::$MM_CHECK_SCHEDULED_EVENT_QUEUE);
		}
		
		$ce = new MM_CronEngine();
		add_action(self::$MM_CRON_HOOK, array($ce, 'performDailyTasks'));
		add_action(self::$MM_CHECK_SCHEDULED_EVENT_QUEUE,array('MM_ScheduledEvent','callSynchronizationHandler'));
	}
	
	public static function cleanup()
	{
		wp_clear_scheduled_hook( self::$MM_CRON_HOOK );
	}
	
	public function performDailyTasks()
	{
		$this->checkForExpiredAccess();
	}
	
	private function checkForExpiredAccess()
	{
		global $wpdb;
		
		// check memberships
		$sql = "SELECT wp_user_id FROM ".MM_TABLE_USER_DATA." WHERE status != ".MM_Status::$EXPIRED;
		$sql .= " AND expiration_date < '".MM_Utils::getCurrentTime()."' AND expiration_date != '0000-00-00 00:00:00'";
		
		$result = $wpdb->get_results($sql);
		
		foreach($result as $row)
		{
			$crntUser = new MM_User($row->wp_user_id);
		
			if($crntUser->isValid())
			{
				$status = $crntUser->getStatus();
			}
		}
		
		// check bundles
		$sql = "SELECT * FROM ".MM_TABLE_APPLIED_BUNDLES." WHERE ";
		$sql .= "access_type = '".MM_AppliedBundle::$ACCESS_TYPE_USER."' AND status != ".MM_Status::$EXPIRED;
		$sql .= " AND expiration_date < '".MM_Utils::getCurrentTime()."' AND expiration_date != '0000-00-00 00:00:00'";
		
		$result = $wpdb->get_results($sql);
		
		foreach($result as $row)
		{
			$crntBundle = MM_AppliedBundle::getAppliedBundle($row->access_type_id, $row->bundle_id);
		
			if($crntBundle->isValid())
			{
				$status = $crntBundle->getStatus();
			}
		}
	}
	
	
	public static function addQueueCheckIntervalRecurrenceOption($schedules)
	{
		// Adds the queue check interval specified below to the existing schedules.
		$schedules['queue_check_interval'] = array(
				'interval' => 1800,
				'display' => __( 'Every 30 mins' )
		);
		return $schedules;
	}
}
